# MOTION GRANTED — CODEBASE STATUS
**Generated:** Thu Feb 12 10:21:04 UTC 2026

## 1. File Structure (lib/)
```
lib/activity/activity-logger.ts
lib/admin/state-toggle.ts
lib/ai/extended-thinking.ts
lib/ai/model-router.ts
lib/ai/openai-client.ts
lib/api-keys.ts
lib/auth/lockout.ts
lib/auth/mfa.ts
lib/auth/password-validation.ts
lib/auth/session.ts
lib/automation/claude.ts
lib/automation/clerk-assigner.ts
lib/automation/conflict-checker.ts
lib/automation/index.ts
lib/automation/notification-sender.ts
lib/automation/qa-checker.ts
lib/automation/report-generator.ts
lib/automation/task-processor.ts
lib/backup/backup-verifier.ts
lib/circuit-breaker.ts
lib/citation/cache-manager.ts
lib/citation/citation-bank.ts
lib/citation/confidence-calculator.ts
lib/citation/decision-handlers.ts
lib/citation/ellipsis-validator.ts
lib/citation/flag-manager.ts
lib/citation/format-validator.ts
lib/citation/high-stakes-detector.ts
lib/citation/pacer-client.ts
lib/citation/steps/step-1-existence.ts
lib/citation/steps/step-2-holding.ts
lib/citation/steps/step-3-dicta.ts
lib/citation/steps/step-4-quotes.ts
lib/citation/steps/step-5-bad-law.ts
lib/citation/steps/step-6-strength.ts
lib/citation/steps/step-7-output.ts
lib/citation/unpublished-handler.ts
lib/citation/verification-pipeline.ts
lib/citations/deduplication.ts
lib/citations/jurisdiction-classifier.ts
lib/citations/statutory-extractor.ts
lib/civ/database.ts
lib/civ/index.ts
lib/civ/model-router.ts
lib/civ/pipeline.ts
lib/civ/report.ts
lib/civ/steps/step-1-existence.ts
lib/civ/steps/step-2-holding.ts
lib/civ/steps/step-3-dicta.ts
lib/civ/steps/step-4-quote.ts
lib/civ/steps/step-5-bad-law.ts
lib/civ/steps/step-6-strength.ts
lib/civ/steps/step-7-output.ts
lib/civ/types.ts
lib/claude-client.ts
lib/compliance/ai-disclosure.ts
lib/compliance/customer-disclosures.ts
lib/config/__tests__/phase-registry.test.ts
lib/config/citation-models.ts
lib/config/feature-flags.ts
lib/config/models.ts
lib/config/motion-types.ts
lib/config/notifications.ts
lib/config/phase-registry.ts
lib/config/pricing.ts
lib/config/state-configs.ts
lib/config/workflow-config.ts
lib/conflicts/check.ts
lib/conflicts/index.ts
lib/conflicts/normalize.ts
lib/conflicts/resolve.ts
lib/conflicts/types.ts
lib/constants.ts
lib/constants/tiers.ts
lib/courtlistener/batched-search.ts
lib/courtlistener/client.ts
lib/courtlistener/query-builder.ts
lib/courtlistener/rate-limiter.ts
lib/courtlistener/relevance-scorer.ts
lib/courtlistener/types.ts
lib/cron/deadline-check.ts
lib/documents/caption-block.ts
lib/documents/certificate-of-service.ts
lib/documents/docx-generator.ts
lib/documents/formatting-engine.ts
lib/documents/generators/case-appendix.ts
lib/documents/generators/ex-parte-generator.ts
lib/documents/generators/exhibit-index.ts
lib/documents/generators/index.ts
lib/documents/generators/instruction-sheet.ts
lib/documents/generators/notice-of-motion.ts
lib/documents/generators/proof-of-service.ts
lib/documents/generators/proposed-order.ts
lib/documents/generators/separate-statement-generator.ts
lib/documents/generators/table-of-authorities.ts
lib/documents/signature-block.ts
lib/documents/storage-service.ts
lib/documents/types.ts
lib/email/action-tokens.ts
lib/email/client.ts
lib/email/email-service.ts
lib/email/email-triggers.ts
lib/email/index.ts
lib/email/retention-emails.ts
lib/email/sender.ts
lib/email/templates.ts
lib/email/templates/cp3-review.tsx
lib/email/templates/hold-notification.tsx
lib/email/templates/order-confirmation.tsx
lib/email/templates/payment-confirmation.tsx
lib/email/url-validator.ts
lib/export/order-exporter.ts
lib/feedback/feedback-service.ts
lib/generators/attorney-instructions.ts
lib/generators/caption-block.ts
lib/generators/declaration-generator.ts
lib/generators/filing-package-assembler.ts
lib/generators/formatting-engine.ts
lib/generators/proof-of-service.ts
lib/generators/signature-block.ts
lib/generators/table-of-contents.ts
lib/inngest/client.ts
lib/inngest/conflict-check-job.ts
lib/inngest/functions.ts
lib/inngest/retention-jobs.ts
lib/inngest/workflow-orchestration.ts
lib/intake/api.ts
lib/intake/conflict-integration.ts
lib/intake/context.tsx
lib/intake/index.ts
lib/intake/jurisdictions.ts
lib/intake/motion-types.ts
lib/intake/pricing.ts
lib/intake/types.ts
lib/intake/validation.ts
lib/integration/doc-gen-bridge.ts
lib/integration/email-triggers.ts
lib/integration/index.ts
lib/integration/storage-manager.ts
lib/legal/deadline-calculator.ts
lib/logger.ts
lib/middleware/rate-limiter.ts
lib/monitoring/alert-sender.ts
lib/monitoring/error-logger.ts
lib/monitoring/index.ts
lib/monitoring/metrics-collector.ts
lib/notifications/email-service.ts
lib/pacer/client.ts
lib/pacer/types.ts
lib/payments/refund-service.ts
lib/pdf/generator.ts
lib/pdf/index.ts
lib/queue-status.ts
lib/rate-limit.ts
lib/rate-limiter.ts
lib/realtime/index.ts
lib/realtime/workflow-subscription.ts
lib/redis.ts
lib/resend.ts
lib/retention/anonymize.ts
lib/retention/delete-order.ts
lib/retention/index.ts
lib/retention/retention-service.ts
lib/search/order-search.ts
lib/security/cron-auth.ts
lib/security/health-endpoint.ts
lib/security/index.ts
lib/security/malware-scanner.ts
lib/security/rate-limiter.ts
lib/services/admin-activity-log.ts
lib/services/citations/batch-processor.ts
lib/services/citations/citation-preprocessor.ts
lib/services/citations/citation-service.ts
lib/services/citations/eyecite-service.ts
lib/services/citations/la-statute-parser.ts
lib/services/citations/shorthand-resolver.ts
lib/services/conflict/conflict-admin-service.ts
lib/services/conflict/conflict-check-service.ts
lib/services/conflict/party-normalizer.ts
lib/services/formatting/index.ts
lib/services/formatting/rule-lookup.ts
lib/services/formatting/types.ts
lib/services/stripe.ts
lib/services/webhook-logger.ts
lib/startup/credential-verifier.ts
lib/storage/archive-service.ts
lib/storage/signed-url.ts
lib/stripe.ts
lib/supabase/client.ts
lib/supabase/middleware.ts
lib/supabase/server.ts
lib/templates/motion-templates.ts
lib/upload/file-validation.ts
lib/utils.ts
lib/utils/env-check.ts
lib/utils/json-extractor.ts
lib/utils/motion-filter.ts
lib/utils/retry.ts
lib/utils/state-validation.ts
lib/validation/order-validation.ts
lib/validations/auth.ts
lib/validations/order.ts
lib/webhooks/webhook-logger.ts
lib/workflow/advisory-injector.ts
lib/workflow/api-guards.ts
lib/workflow/automation-service.ts
lib/workflow/checkpoint-service.ts
lib/workflow/citation-verifier.ts
lib/workflow/courtlistener-client.ts
lib/workflow/document-extractor.ts
lib/workflow/document-parser.ts
lib/workflow/file-system.ts
lib/workflow/gap-closure-protocols.ts
lib/workflow/hold-service.ts
lib/workflow/index.ts
lib/workflow/model-router.ts
lib/workflow/motion-advisories.ts
lib/workflow/motion-templates.ts
lib/workflow/orchestrator.ts
lib/workflow/pdf-generator.ts
lib/workflow/phase-config.ts
lib/workflow/phase-executor.ts
lib/workflow/phase-executors.ts
lib/workflow/phase-gates.ts
lib/workflow/phase-iv/element-extraction.ts
lib/workflow/phase-iv/holding-verification.ts
lib/workflow/phase-iv/index.ts
lib/workflow/phase-iv/multi-step-executor.ts
lib/workflow/phase-iv/parallel-search.ts
lib/workflow/phase-iv/scoring.ts
lib/workflow/phases/phase-i.ts
lib/workflow/phases/phase-ii.ts
lib/workflow/phases/phase-ix.ts
lib/workflow/phases/phase-viii-5.ts
lib/workflow/phases/phase-x.ts
lib/workflow/prompt-guardrails.ts
lib/workflow/quality-validator.ts
lib/workflow/revision-handler.ts
lib/workflow/revision-loop.ts
lib/workflow/superprompt-builder.ts
lib/workflow/superprompt-engine.ts
lib/workflow/superprompt.ts
lib/workflow/utils/deadline-calculator.ts
lib/workflow/validators/deadline-validator.ts
lib/workflow/validators/document-date-validator.ts
lib/workflow/validators/memo-jurisdiction-check.ts
lib/workflow/validators/placeholder-validator.ts
lib/workflow/validators/proposed-order-validator.ts
lib/workflow/validators/protocol10-disclosure.ts
lib/workflow/validators/required-documents.ts
lib/workflow/violation-alerts.ts
lib/workflow/workflow-state.ts
```

## 2. File Structure (app/api/)
```
app/api/account/delete/route.ts
app/api/admin/activity-log/route.ts
app/api/admin/activity/route.ts
app/api/admin/analytics/costs/route.ts
app/api/admin/analytics/route.ts
app/api/admin/cron-trigger/route.ts
app/api/admin/orders/[id]/citations/save/route.ts
app/api/admin/queue-order/route.ts
app/api/admin/reset-queue/route.ts
app/api/admin/revision-requests/[id]/route.ts
app/api/admin/states/metadata/route.ts
app/api/admin/states/route.ts
app/api/auth/change-password/route.ts
app/api/auth/login/route.ts
app/api/auth/logout-all/route.ts
app/api/auth/mfa/enroll/route.ts
app/api/auth/mfa/status/route.ts
app/api/auth/mfa/verify/route.ts
app/api/automation/approval-queue/route.ts
app/api/automation/clerk-assignment/route.ts
app/api/automation/conflict-check/route.ts
app/api/automation/cron/route.ts
app/api/automation/dashboard/route.ts
app/api/automation/logs/route.ts
app/api/automation/process/route.ts
app/api/automation/qa-check/route.ts
app/api/automation/restart/route.ts
app/api/automation/resume/route.ts
app/api/automation/settings/route.ts
app/api/automation/start/route.ts
app/api/chat/approve/route.ts
app/api/chat/route.ts
app/api/chat/start/route.ts
app/api/citations/[opinionId]/route.ts
app/api/citations/batch/route.ts
app/api/civ/batch/route.ts
app/api/civ/report/[id]/route.ts
app/api/civ/test/route.ts
app/api/civ/verify/route.ts
app/api/conflicts/check/route.ts
app/api/conflicts/review/route.ts
app/api/contact/route.ts
app/api/cron/daily-cleanup/route.ts
app/api/cron/hold-enforcer/route.ts
app/api/documents/route.ts
app/api/documents/upload/route.ts
app/api/email-actions/[token]/route.ts
app/api/health/deep/route.ts
app/api/health/detailed/route.ts
app/api/health/queue/route.ts
app/api/health/route.ts
app/api/inngest/route.ts
app/api/motion-types/route.ts
app/api/orders/[id]/approve/route.ts
app/api/orders/[id]/citations/route.ts
app/api/orders/[id]/deliverables/route.ts
app/api/orders/[id]/documents/download-all/route.ts
app/api/orders/[id]/documents/route.ts
app/api/orders/[id]/download/route.ts
app/api/orders/[id]/generate/route.ts
app/api/orders/[id]/notify-delivery/route.ts
app/api/orders/[id]/request-changes/route.ts
app/api/orders/[id]/retention/route.ts
app/api/orders/[id]/revision-request/route.ts
app/api/orders/[id]/revision/route.ts
app/api/orders/[id]/workflow/route.ts
app/api/orders/conflict-check/route.ts
app/api/orders/route.ts
app/api/settings/api-keys/route.ts
app/api/settings/api-keys/test/route.ts
app/api/superprompt/parse-docx/route.ts
app/api/superprompt/templates/route.ts
app/api/upload/validate/route.ts
app/api/waitlist/route.ts
app/api/webhooks/stripe/route.ts
app/api/workflow/[id]/approve/route.ts
app/api/workflow/[id]/execute/route.ts
app/api/workflow/approve/route.ts
app/api/workflow/cancel/route.ts
app/api/workflow/checkpoint/route.ts
app/api/workflow/generate/route.ts
app/api/workflow/hold-response/route.ts
app/api/workflow/orchestrate/route.ts
app/api/workflow/request-changes/route.ts
app/api/workflow/restart/route.ts
app/api/workflow/revisions/checkout/route.ts
app/api/workflow/route.ts
```

## 3. Prompt Files
```
total 329
drwxr-xr-x  2 root root  4096 Feb 12 10:20 .
drwxr-xr-x 19 root root  4096 Feb 12 10:21 ..
-rw-r--r--  1 root root 16777 Feb 12 10:20 PHASE_III_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  4055 Feb 12 10:20 PHASE_III_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  4934 Feb 12 10:20 PHASE_III_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 15804 Feb 12 10:20 PHASE_II_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  2647 Feb 12 10:20 PHASE_II_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  1596 Feb 12 10:20 PHASE_II_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 18204 Feb 12 10:20 PHASE_IV_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  6721 Feb 12 10:20 PHASE_IV_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  7259 Feb 12 10:20 PHASE_IV_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 12723 Feb 12 10:20 PHASE_IX1_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  1989 Feb 12 10:20 PHASE_IX1_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root   847 Feb 12 10:20 PHASE_IX1_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 18787 Feb 12 10:20 PHASE_IX_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  2608 Feb 12 10:20 PHASE_IX_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root   981 Feb 12 10:20 PHASE_IX_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 15570 Feb 12 10:20 PHASE_I_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  4193 Feb 12 10:20 PHASE_I_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  2773 Feb 12 10:20 PHASE_I_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 17571 Feb 12 10:20 PHASE_V1_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root 12651 Feb 12 10:20 PHASE_V1_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root 11262 Feb 12 10:20 PHASE_V1_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 14666 Feb 12 10:20 PHASE_VII1_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  3680 Feb 12 10:20 PHASE_VII1_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  1090 Feb 12 10:20 PHASE_VII1_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 14150 Feb 12 10:20 PHASE_VIII5_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  2772 Feb 12 10:20 PHASE_VIII5_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  1159 Feb 12 10:20 PHASE_VIII5_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 13431 Feb 12 10:20 PHASE_VIII_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  3046 Feb 12 10:20 PHASE_VIII_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  1420 Feb 12 10:20 PHASE_VIII_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 14634 Feb 12 10:20 PHASE_VII_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  4644 Feb 12 10:20 PHASE_VII_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  2960 Feb 12 10:20 PHASE_VII_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 12096 Feb 12 10:20 PHASE_VI_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  3209 Feb 12 10:20 PHASE_VI_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  2914 Feb 12 10:20 PHASE_VI_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root 16326 Feb 12 10:20 PHASE_V_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  5852 Feb 12 10:20 PHASE_V_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  2426 Feb 12 10:20 PHASE_V_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root  7289 Feb 12 10:20 PHASE_X_SYSTEM_PROMPT_v721.md
-rw-r--r--  1 root root  4814 Feb 12 10:20 PHASE_X_SYSTEM_PROMPT_v741.md
-rw-r--r--  1 root root  2907 Feb 12 10:20 PHASE_X_SYSTEM_PROMPT_v75.md
-rw-r--r--  1 root root  2979 Feb 12 10:20 index.ts
```

## 4. Phase Executors — Imports
```typescript
/**
 * Phase Executors - v7.2 Complete Implementation
 *
 * STRICT 14-PHASE ENFORCEMENT:
 * Each phase has a specific task. Claude CANNOT skip phases or generate
 * the final motion directly. Each phase produces structured JSON output
 * that feeds into the next phase.
 *
 * Phase Flow:
 * I → II → III → [HOLD?] → IV → V → V.1 → VI → VII → [VIII loop?] → VIII.5 → IX → [IX.1?] → X
 */

import Anthropic from '@anthropic-ai/sdk';
import { createClient } from '@/lib/supabase/server';
import { createMessageWithStreaming } from '@/lib/automation/claude';
import { extractJSON } from '@/lib/utils/json-extractor';
import {
  validateMotionObject,
  generateRevisionInstructions,
  type PlaceholderValidationResult,
} from './validators/placeholder-validator';
import type {
  WorkflowPhaseCode,
  MotionTier,
  PhaseStatus,
  JudgeSimulationResult,
  LetterGrade,
} from '@/types/workflow';
import { PHASE_PROMPTS } from '@/prompts';
import { getModel, getThinkingBudget, getMaxTokens } from '@/lib/config/phase-registry';
import { MODELS } from '@/lib/config/models';
import { saveOrderCitations } from '@/lib/services/citations/citation-service';
import type { SaveCitationInput } from '@/types/citations';

// ============================================================================
// TYPES
// ============================================================================

export interface PhaseInput {
  orderId: string;
  workflowId: string;
  tier: MotionTier;
  jurisdiction: string;
  motionType: string;
  caseCaption: string;
  caseNumber: string;
  courtDivision?: string;
  statementOfFacts: string;
  proceduralHistory: string;
  instructions: string;
  previousPhaseOutputs: Record<WorkflowPhaseCode, unknown>;
  documents?: string[];
  revisionLoop?: number;

  // Party information
  parties?: Array<{
    name: string;
    role: 'plaintiff' | 'defendant' | 'petitioner' | 'respondent';
    isRepresented?: boolean;
  }>;
```

## 5. Phase Executors — Model Selection (if local function exists)
```typescript
30:import { getModel, getThinkingBudget, getMaxTokens } from '@/lib/config/phase-registry';
31-import { MODELS } from '@/lib/config/models';
32-import { saveOrderCitations } from '@/lib/services/citations/citation-service';
33-import type { SaveCitationInput } from '@/types/citations';
34-
35-// ============================================================================
36-// TYPES
37-// ============================================================================
38-
39-export interface PhaseInput {
40-  orderId: string;
41-  workflowId: string;
42-  tier: MotionTier;
43-  jurisdiction: string;
44-  motionType: string;
45-  caseCaption: string;
46-  caseNumber: string;
47-  courtDivision?: string;
48-  statementOfFacts: string;
49-  proceduralHistory: string;
50-  instructions: string;
--
544:    const model = getModel('I', input.tier) ?? MODELS.SONNET;
545-    console.log(`[Phase I] Calling Claude with model: ${model}, max_tokens: 64000`);
546-    console.log(`[Phase I] Input context length: ${userMessage.length} chars`);
547-
548-    const callStart = Date.now();
549-    const response = await createMessageWithStreaming(client, {
550-      model,
551-      max_tokens: 64000, // Phase I: Document intake analysis
552-      system: systemPrompt,
553-      messages: [{ role: 'user', content: userMessage }],
554-    });
555-    const callDuration = Date.now() - callStart;
556-
557-    console.log(`[Phase I] Claude responded in ${callDuration}ms`);
558-    console.log(`[Phase I] Tokens used - Input: ${response.usage.input_tokens}, Output: ${response.usage.output_tokens}`);
559-    console.log(`[Phase I] Stop reason: ${response.stop_reason}`);
560-
561-    const textContent = response.content.find(c => c.type === 'text');
```

## 6. Phase Executors — What prompts are used
```
29:import { PHASE_PROMPTS } from '@/prompts';
521:${PHASE_PROMPTS.PHASE_I}`;
552:      system: systemPrompt,
692:${PHASE_PROMPTS.PHASE_II}`;
707:      system: systemPrompt,
875:${PHASE_PROMPTS.PHASE_III}`;
890:      system: systemPrompt,
1286:${PHASE_PROMPTS.PHASE_V}
1437:      system: systemPrompt,
2479:${PHASE_PROMPTS.PHASE_V1}`;
2520:        system: systemPrompt,
2677:${PHASE_PROMPTS.PHASE_VI}
2694:      system: systemPrompt,
2792:${PHASE_PROMPTS.PHASE_VII}
2828:      system: systemPrompt,
2899:${PHASE_PROMPTS.PHASE_VII1}`;
2911:      system: systemPrompt,
3028:${PHASE_PROMPTS.PHASE_VIII}
3115:      system: systemPrompt,
3295:${PHASE_PROMPTS.PHASE_VIII5}`;
3311:      system: systemPrompt,
3407:${PHASE_PROMPTS.PHASE_IX}
3449:      system: systemPrompt,
3531:${PHASE_PROMPTS.PHASE_IX1}
3552:      system: systemPrompt,
3632:${PHASE_PROMPTS.PHASE_X}
3653:      system: systemPrompt,
```

## 7. Model Routing Definitions (all files)
```
./types/workflow.ts:847://   - MODEL_ROUTING array
./types/workflow.ts:848://   - getModelForPhase() function
./lib/workflow/phase-config.ts:214:// getModelForPhase(), getExtendedThinkingBudget(), and usesExtendedThinking()
./lib/config/phase-registry.ts:19: *   DC-001  getModelForPhase() — now getModel()
./lib/config/phase-registry.ts:25: *   - phase-executors.ts lines 112-132 (local getModelForPhase/getThinkingBudget)
./lib/config/phase-registry.ts:26: *   - phase-config.ts getModelForPhase duplicate
./lib/config/phase-registry.ts:27: *   - types/workflow.ts MODEL_ROUTING, EXTENDED_THINKING_CONFIG, CITATION_BATCH_SIZES
./lib/config/phase-registry.ts:28: *   - model-router.ts shouldUseOpus(), getModelForPhase() wrapper
./lib/civ/model-router.ts:28:export const MODEL_ROUTING = {
./lib/civ/model-router.ts:87:  const tierKey = `tier_${tier.toLowerCase()}` as keyof typeof MODEL_ROUTING;
./lib/civ/model-router.ts:88:  return MODEL_ROUTING[tierKey][task];
```

## 8. Quality Thresholds (all files)
```
./types/workflow.ts:804:export const MINIMUM_PASSING_GRADE: LetterGrade = 'B+';
./types/workflow.ts:805:export const MINIMUM_PASSING_VALUE = 3.3;
./types/workflow.ts:836:export function gradePasses(grade: LetterGrade): boolean {
./types/workflow.ts:837:  return GRADE_VALUES[grade] >= MINIMUM_PASSING_VALUE;
./lib/workflow/phase-config.ts:56:  minGrade?: number;
./lib/workflow/phase-config.ts:140:    minGrade: 3.3, // A- minimum quality threshold (numeric 3.3/4.0)
./lib/workflow/phase-config.ts:225:    gradePasses?: boolean;
./lib/workflow/phase-config.ts:235:    const passes = options.gradePasses ?? false;  // NEVER default to passing. Require explicit grade.
./lib/workflow/phase-config.ts:324:export const MINIMUM_PASSING_GRADE = 3.3; // A- minimum quality standard
./lib/workflow/phase-config.ts:330:export function gradePasses(numericGrade: number): boolean {
./lib/workflow/phase-config.ts:331:  return numericGrade >= MINIMUM_PASSING_GRADE;
./lib/workflow/quality-validator.ts:62: * IMPORTANT: A- = 0.87 is the PASSING grade threshold
./lib/workflow/quality-validator.ts:66:  acceptable: 0.87,       // A- — this is the PASSING grade per v6.3
./lib/workflow/quality-validator.ts:580:  if (score >= 0.87) return 'B+';
./lib/workflow/quality-validator.ts:581:  if (score >= 0.83) return 'B';
./lib/workflow/quality-validator.ts:596:  return score >= QUALITY_THRESHOLDS.acceptable; // A- = 0.87
./lib/workflow/workflow-state.ts:55:export const MINIMUM_PASSING_GRADE = 0.87;
./lib/workflow/workflow-state.ts:94:  return score >= MINIMUM_PASSING_GRADE;
./lib/config/phase-registry.ts:101:/** Quality threshold. B+ = 0.87 for ALL tiers. (§1.5 item 8) */
./lib/config/phase-registry.ts:102:export const QUALITY_THRESHOLD = 0.87;
./lib/config/phase-registry.ts:109:  'B+': 0.87,
./lib/config/phase-registry.ts:110:  'B':  0.83,
./lib/config/__tests__/phase-registry.test.ts:43:  it('quality threshold is 0.87 (B+)', () => {
./lib/config/__tests__/phase-registry.test.ts:44:    expect(QUALITY_THRESHOLD).toBe(0.87);
./lib/config/workflow-config.ts:101:  JUDGE_GRADE_MINIMUM: { A: 0.83, B: 0.87, C: 0.87 },
./lib/config/workflow-config.ts:103:  QUALITY_PASSING: 0.87,
./lib/inngest/functions.ts:1001:  gradePasses,
./lib/inngest/functions.ts:1190:        const passes = gradePasses(numericGrade);
./lib/inngest/functions.ts:1207:          gradePasses: passes,
./lib/inngest/workflow-orchestration.ts:61:  MINIMUM_PASSING_VALUE,
./lib/inngest/workflow-orchestration.ts:64:  gradePasses,
./lib/inngest/workflow-orchestration.ts:1703:          passes: workflowState.currentGrade ? gradePasses(workflowState.currentGrade) : false,
./lib/inngest/workflow-orchestration.ts:1730:      !gradePasses(workflowState.currentGrade) &&
./lib/citation/confidence-calculator.ts:369:        highConfidence: 0.87,
./lib/constants/tiers.ts:106:    qualityThreshold: 0.87,   // B+ = A- minimum (same for all tiers)
./lib/constants/tiers.ts:114:    qualityThreshold: 0.87,
./lib/constants/tiers.ts:122:    qualityThreshold: 0.87,
./lib/constants/tiers.ts:184:export const MINIMUM_PASSING_GRADE = 3.3; // A- minimum quality standard
./lib/constants/tiers.ts:230:export function gradePassesThreshold(grade: LetterGrade): boolean {
```

## 9. Extended Thinking Budgets
```
./types/workflow.ts:560:  extendedThinkingBudget?: number;
./types/workflow.ts:619:    extendedThinkingBudget: 8000,
./types/workflow.ts:629:    extendedThinkingBudget: 10000,
./types/workflow.ts:647:    extendedThinkingBudget: 8000,
./lib/workflow/phase-executors.ts:1447:    if (callDuration < 10000) {
./lib/workflow/phase-executors.ts:2670:    const thinkingBudget = getThinkingBudget('VI', input.tier);
./lib/workflow/phase-executors.ts:2679:${thinkingBudget ? 'Use extended thinking to deeply analyze potential opposition strategies and vulnerabilities.' : ''}`;
./lib/workflow/phase-executors.ts:2699:    if (thinkingBudget) {
./lib/workflow/phase-executors.ts:2702:        budget_tokens: thinkingBudget,
./lib/workflow/phase-executors.ts:2788:    const thinkingBudget = getThinkingBudget('VII', input.tier); // Always 10K for Phase VII
./lib/workflow/phase-executors.ts:2832:        budget_tokens: thinkingBudget || 10000, // Use config, fallback to 10K
./lib/workflow/phase-executors.ts:2972:    const thinkingBudget = getThinkingBudget('VIII', input.tier);
./lib/workflow/phase-executors.ts:3058:${thinkingBudget ? 'Use extended thinking to carefully address each issue.' : ''}
./lib/workflow/phase-executors.ts:3120:    if (thinkingBudget) {
./lib/workflow/phase-executors.ts:3123:        budget_tokens: thinkingBudget,
./lib/workflow/phase-config.ts:48:  extendedThinking: Record<Tier, boolean>;
./lib/workflow/phase-config.ts:71:    extendedThinking: { A: false, B: false, C: false },
./lib/workflow/phase-config.ts:80:    extendedThinking: { A: false, B: false, C: false },
./lib/workflow/phase-config.ts:89:    extendedThinking: { A: false, B: false, C: true },
./lib/workflow/phase-config.ts:90:    budget: 10000,
./lib/workflow/phase-config.ts:98:    extendedThinking: { A: false, B: false, C: false },
./lib/workflow/phase-config.ts:107:    extendedThinking: { A: false, B: false, C: true },
./lib/workflow/phase-config.ts:108:    budget: 10000,
./lib/workflow/phase-config.ts:116:    extendedThinking: { A: false, B: false, C: false },
./lib/workflow/phase-config.ts:126:    extendedThinking: { A: false, B: true, C: true },
./lib/workflow/phase-config.ts:135:    extendedThinking: { A: true, B: true, C: true }, // ALWAYS ENABLED
./lib/workflow/phase-config.ts:136:    budget: 10000,
./lib/workflow/phase-config.ts:147:    extendedThinking: { A: false, B: false, C: false },
./lib/workflow/phase-config.ts:157:    extendedThinking: { A: false, B: true, C: true },
./lib/workflow/phase-config.ts:167:    extendedThinking: { A: false, B: false, C: false },
```

## 10. Dead Code Indicators

### superprompt-builder.ts exists?
YES — still exists

### superprompt-builder imports:
```
NONE — dead code confirmed
```

### Duplicate realtime hooks:
```
-rw-r--r-- 1 root root 13810 Feb 12 10:20 hooks/use-workflow-realtime.ts
-rw-r--r-- 1 root root 14986 Feb 12 10:20 hooks/useWorkflowRealtime.ts
-rw-r--r-- 1 root root 14986 Feb 12 10:20 hooks/useWorkflowRealtime.ts
```

### workflow.ts MODEL_ROUTING exists?
```
847://   - MODEL_ROUTING array
```

## 11. Potential Issues

### gradePasses default:
```
225:    gradePasses?: boolean;
235:    const passes = options.gradePasses ?? false;  // NEVER default to passing. Require explicit grade.
330:export function gradePasses(numericGrade: number): boolean {
```

### Phase completion requirements:
```
export const PHASE_COMPLETION_REQUIREMENTS: Record<PhaseId, string[]> = {
  'I': ['tier', 'motion_type', 'jurisdiction'],
  'II': ['extracted_facts', 'legal_issues'],
  'III': ['evidence_matrix', 'research_queries'],
  'IV': ['case_citation_bank', 'citations_found'],
  'V': ['draft_text'],
  'V.1': ['verification_results'],
  'VI': [],  // Empty OK — Tier A skips this phase entirely
  'VII': ['grade', 'deficiencies'],
  'VII.1': ['verification_results'],
  'VIII': ['revised_draft'],
  'VIII.5': ['caption_validated'],
  'IX': ['supporting_documents'],
  'IX.1': ['verification_results'],
  'X': ['final_package'],
};

// ============================================================================
// MOTION TYPES REQUIRING SPECIFIC PHASES
// ============================================================================

--
  const requirements = PHASE_COMPLETION_REQUIREMENTS[phase];
  const missingOutputs = requirements.filter((req) => {
    // Check if the output exists and is truthy
```

### Citation verifier — api_error handling:
```
513:    // BUG-FIX-01: api_error results must NOT count toward verified minimums
528:        // This prevents api_error from being implicitly counted as "not failed"
```

### HOLD enforcement mode:
```
./lib/config/feature-flags.ts:23: * HOLD_ENFORCEMENT_MODE
./lib/config/feature-flags.ts:31:  const val = process.env.HOLD_ENFORCEMENT_MODE?.toLowerCase().trim();
./lib/config/feature-flags.ts:38: * DEADLINE_VALIDATION_MODE
./lib/config/feature-flags.ts:46:  const val = process.env.DEADLINE_VALIDATION_MODE?.toLowerCase().trim();
./lib/inngest/workflow-orchestration.ts:1423:              message: 'HOLD detected but bypassed due to HOLD_ENFORCEMENT_MODE=warn',
./.env.example:111:HOLD_ENFORCEMENT_MODE=enforce
./.env.example:115:DEADLINE_VALIDATION_MODE=enforce
```

### Payment-order linking:
```
89:          metadata: {
269:  let orderId = paymentIntent.metadata?.order_id;
272:  // FALLBACK: Use metadata order_id only as secondary confirmation
306:      order_id: orderId,
346:      order_id: orderId,
360:    order_id: orderId,
427:        order_id: orderId,
438:        order_id: orderId,
458:  const orderId = paymentIntent.metadata?.order_id;
475:    order_id: orderId,
489:    order_id: orderId,
552:    order_id: order.id,
573:  const orderId = paymentIntent.metadata?.order_id;
590:    order_id: orderId,
609:  if (session.metadata?.type === 'revision') {
```

## 12. Codebase Health Metrics

| Metric | Count |
|--------|-------|
| Total .ts files | 377 |
| Total .tsx files | 216 |
| `as any` count | 10 |
| console.log in lib/ | 805 |
| TODO/FIXME/HACK | 5 |
| @ts-ignore | 4 |

## 13. TypeScript Build Status
```
tests/e2e/order-creation.spec.ts(258,58): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(264,60): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(272,65): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(277,78): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(284,69): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(306,57): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(319,61): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(340,28): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(349,71): error TS7031: Binding element 'page' implicitly has an 'any' type.
tests/e2e/order-creation.spec.ts(357,55): error TS7031: Binding element 'page' implicitly has an 'any' type.
```

## 14. Last 20 Commits
```
9303522 Merge pull request #222 from ptanner66-prog/claude/audit-production-errors-lmt5z
98d6618 feat: add ADMIN_MFA_MODE env toggle for testing
251be2b Merge pull request #221 from ptanner66-prog/claude/audit-data-flow-cSb4P
ee70f9a fix: lower minimum citation thresholds for simple motions
c24cbdc Merge pull request #220 from ptanner66-prog/claude/audit-production-errors-lmt5z
5b98321 fix: render citation fallback in modal when no CourtListener ID
ad10117 Merge pull request #219 from ptanner66-prog/claude/audit-production-errors-lmt5z
7bebac0 Merge branch 'main' into claude/audit-production-errors-lmt5z
deca81f Merge pull request #218 from ptanner66-prog/claude/audit-data-flow-cSb4P
0e20259 fix: SP12 data flow audit — fix 7 broken data pipes across workflow
512beeb fix: pass raw document text to phases when parsed summaries empty
0618192 Merge pull request #217 from ptanner66-prog/claude/audit-production-errors-lmt5z
0edb68f fix: disable false-positive HOLD + is_deliverable NULL bug
d39d785 Merge pull request #216 from ptanner66-prog/claude/audit-production-errors-lmt5z
b58a8a1 fix: SP11 production errors audit — fix 11 stop-ship issues
94ac3c7 Merge pull request #215 from ptanner66-prog/claude/fix-build-errors-OvJwx
45aa8f7 fix: add missing orderError destructuring in orchestrate route
18c2991 Merge SP9+SP10: 51-state formatting, build fixes, Clay test prep
431c055 Merge pull request #213 from ptanner66-prog/claude/chen-sp8-prelaunch-ZyWLX
7034eff Merge branch 'main' into claude/chen-sp8-prelaunch-ZyWLX
```

## 15. Files Changed in Last 3 Days
```
.env.example
ENGINE_AUDIT.md
PRODUCTION_CHECKLIST.md
app/(admin)/admin/health/health-quick-actions.tsx
app/(admin)/admin/jurisdictions/page.tsx
app/(admin)/admin/setup-mfa/page.tsx
app/(admin)/admin/verify-mfa/page.tsx
app/(dashboard)/orders/[id]/review/page.tsx
app/api/account/delete/route.ts
app/api/admin/analytics/costs/route.ts
app/api/admin/cron-trigger/route.ts
app/api/admin/revision-requests/[id]/route.ts
app/api/admin/states/metadata/route.ts
app/api/admin/states/route.ts
app/api/auth/logout-all/route.ts
app/api/auth/mfa/enroll/route.ts
app/api/auth/mfa/status/route.ts
app/api/auth/mfa/verify/route.ts
app/api/automation/restart/route.ts
app/api/chat/approve/route.ts
app/api/chat/route.ts
app/api/civ/test/route.ts
app/api/cron/daily-cleanup/route.ts
app/api/cron/hold-enforcer/route.ts
app/api/documents/upload/route.ts
app/api/inngest/route.ts
app/api/motion-types/route.ts
app/api/orders/[id]/approve/route.ts
app/api/orders/[id]/documents/route.ts
app/api/orders/[id]/download/route.ts
app/api/orders/[id]/generate/route.ts
app/api/orders/[id]/request-changes/route.ts
app/api/orders/route.ts
app/api/settings/api-keys/test/route.ts
app/api/test/claude/route.ts
app/api/waitlist/route.ts
app/api/webhooks/stripe/route.ts
app/api/workflow/[id]/execute/route.ts
app/api/workflow/orchestrate/route.ts
components/admin/state-toggle-row.tsx
components/citations/CitationModal.tsx
components/citations/CitationViewer.tsx
components/dashboard/checkpoint-status.tsx
components/dashboard/document-card.tsx
components/dashboard/hold-response-form.tsx
components/dashboard/order-status-card.tsx
components/dashboard/order-timeline.tsx
components/dashboard/quality-badge.tsx
components/shared/error-boundary.tsx
data/formatting/configs/states/alabama.json
data/formatting/configs/states/alaska.json
data/formatting/configs/states/arizona.json
data/formatting/configs/states/arkansas.json
data/formatting/configs/states/california.json
data/formatting/configs/states/colorado.json
data/formatting/configs/states/connecticut.json
data/formatting/configs/states/delaware.json
data/formatting/configs/states/district_of_columbia.json
data/formatting/configs/states/florida.json
data/formatting/configs/states/georgia.json
data/formatting/configs/states/hawaii.json
data/formatting/configs/states/idaho.json
data/formatting/configs/states/illinois.json
data/formatting/configs/states/indiana.json
data/formatting/configs/states/iowa.json
data/formatting/configs/states/kansas.json
data/formatting/configs/states/kentucky.json
data/formatting/configs/states/louisiana.json
data/formatting/configs/states/maine.json
data/formatting/configs/states/maryland.json
data/formatting/configs/states/massachusetts.json
data/formatting/configs/states/michigan.json
data/formatting/configs/states/minnesota.json
data/formatting/configs/states/mississippi.json
data/formatting/configs/states/missouri.json
data/formatting/configs/states/montana.json
data/formatting/configs/states/nebraska.json
data/formatting/configs/states/nevada.json
data/formatting/configs/states/new_hampshire.json
data/formatting/configs/states/new_jersey.json
data/formatting/configs/states/new_mexico.json
data/formatting/configs/states/new_york.json
data/formatting/configs/states/north_carolina.json
data/formatting/configs/states/north_dakota.json
data/formatting/configs/states/ohio.json
data/formatting/configs/states/oklahoma.json
data/formatting/configs/states/oregon.json
data/formatting/configs/states/pennsylvania.json
data/formatting/configs/states/rhode_island.json
data/formatting/configs/states/south_carolina.json
data/formatting/configs/states/south_dakota.json
data/formatting/configs/states/tennessee.json
data/formatting/configs/states/texas.json
data/formatting/configs/states/utah.json
data/formatting/configs/states/vermont.json
data/formatting/configs/states/virginia.json
data/formatting/configs/states/washington.json
data/formatting/configs/states/west_virginia.json
data/formatting/configs/states/wisconsin.json
data/formatting/configs/states/wyoming.json
docs/SP12_DATA_FLOW_REPORT.md
lib/admin/state-toggle.ts
lib/auth/mfa.ts
lib/citation/ellipsis-validator.ts
lib/civ/pipeline.ts
lib/civ/steps/step-4-quote.ts
lib/civ/types.ts
lib/documents/docx-generator.ts
lib/documents/formatting-engine.ts
lib/email/client.ts
lib/email/index.ts
lib/email/retention-emails.ts
lib/email/sender.ts
lib/email/templates.ts
lib/export/order-exporter.ts
lib/generators/attorney-instructions.ts
lib/generators/caption-block.ts
lib/generators/declaration-generator.ts
lib/generators/filing-package-assembler.ts
lib/generators/formatting-engine.ts
lib/generators/proof-of-service.ts
lib/generators/signature-block.ts
lib/generators/table-of-contents.ts
lib/inngest/functions.ts
lib/inngest/workflow-orchestration.ts
lib/integration/doc-gen-bridge.ts
lib/integration/email-triggers.ts
lib/integration/index.ts
lib/integration/storage-manager.ts
lib/pdf/generator.ts
lib/pdf/index.ts
lib/security/cron-auth.ts
lib/security/health-endpoint.ts
lib/security/index.ts
lib/security/malware-scanner.ts
lib/security/rate-limiter.ts
lib/services/formatting/index.ts
lib/services/formatting/rule-lookup.ts
lib/services/formatting/types.ts
lib/services/stripe.ts
lib/storage/signed-url.ts
lib/utils/json-extractor.ts
lib/workflow/advisory-injector.ts
lib/workflow/automation-service.ts
lib/workflow/checkpoint-service.ts
lib/workflow/document-extractor.ts
lib/workflow/document-parser.ts
lib/workflow/hold-service.ts
lib/workflow/index.ts
lib/workflow/motion-advisories.ts
lib/workflow/orchestrator.ts
lib/workflow/pdf-generator.ts
lib/workflow/phase-executor.ts
lib/workflow/phase-executors.ts
lib/workflow/phase-iv/multi-step-executor.ts
lib/workflow/revision-loop.ts
lib/workflow/validators/required-documents.ts
lib/workflow/violation-alerts.ts
lib/workflow/workflow-engine.ts
lib/workflow/workflow-state.ts
middleware.ts
next.config.ts
package.json
pnpm-lock.yaml
scripts/CLAY_TEST_CHECKLIST.md
scripts/LA_ORDER_TRACE.md
scripts/check-env.ts
scripts/clay-test-order.json
scripts/e2e-smoke-test.ts
scripts/generate-test-package.ts
scripts/setup-storage.ts
scripts/test-formatting-fixtures.ts
scripts/test-formatting-integration.ts
sentry.client.config.ts
sentry.edge.config.ts
sentry.server.config.ts
supabase/migrations/20260211000001_jurisdiction_toggles.sql
supabase/migrations/20260211_bug11_atomic_revision_counter.sql
supabase/migrations/20260212000001_storage_rls.sql
tsconfig.json
vercel.json
```
